 <!DOCTYPE html>
<html lang="ar" dir="rtl" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ù„Ù Ø¥Ù†Ø¬Ø§Ø² Ù…Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ­ÙŠØ¯</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0a0e27 100%);
      color: white;
    }

    .app-wrapper {
      height: 100%;
      width: 100%;
      overflow-y: auto;
    }

    .stars-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.3); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }

    .slide-in {
      animation: slideIn 0.6s ease-out forwards;
    }

    .animate-float {
      animation: float 4s ease-in-out infinite;
    }

    .glass-card {
      background: rgba(26, 31, 58, 0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.4s ease;
    }

    .section-card {
      background: linear-gradient(145deg, rgba(26, 31, 58, 0.9), rgba(15, 20, 40, 0.9));
      border: 2px solid rgba(139, 92, 246, 0.3);
      transition: all 0.4s ease;
    }

    .section-card:hover {
      border-color: #06b6d4;
      transform: translateY(-3px);
    }

    .content-wrapper {
      position: relative;
      z-index: 1;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      z-index: 100;
      align-items: center;
      justify-content: center;
      overflow-y: auto;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(145deg, #1a1f3a, #0a0e27);
      border: 2px solid #8b5cf6;
      border-radius: 20px;
      padding: 30px;
      max-width: 900px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(139, 92, 246, 0.4);
      margin: 20px auto;
      position: relative;
    }

    .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 2rem;
      cursor: pointer;
      color: #cbd5e1;
      transition: all 0.3s ease;
      background: none;
      border: none;
      padding: 0;
    }

    .close-btn:hover {
      color: #ef4444;
      transform: scale(1.2);
    }

    .notification-toast {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: linear-gradient(135deg, #10b981, #059669);
      padding: 16px 24px;
      border-radius: 12px;
      color: white;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      animation: slideInUp 0.4s ease-out;
      z-index: 1000;
    }

    @keyframes slideInUp {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .notification-toast.error {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    .semester-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .semester-tab-btn {
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }

    .semester-tab-btn.active {
      background: linear-gradient(45deg, #8b5cf6, #7c3aed);
      color: white;
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
    }

    .semester-tab-btn.inactive {
      background: #2d3748;
      color: #cbd5e1;
    }

    .semester-tab-btn:hover {
      transform: translateY(-2px);
    }

    .member-badge {
      background: linear-gradient(135deg, #3b82f6, #1e40af);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      text-sm;
      display: inline-flex;
      align-items: center;
      gap: 12px;
    }

    .member-badge button {
      background: #ef4444;
      color: white;
      border: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.2s;
    }

    .member-badge button:hover {
      background: #dc2626;
      transform: scale(1.1);
    }

    .achievement-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      font-size: 1.8rem;
    }

    .achievement-icon:hover {
      transform: scale(1.1);
    }

    .achievement-icon.unlocked {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border-color: #fbbf24;
      box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
    }

    .achievement-icon.locked {
      background: #2d3748;
      border-color: #4b5563;
      opacity: 0.5;
    }

    .winner-badge {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: #78350f;
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: bold;
      text-align: center;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .progress-container {
      background: rgba(139, 92, 246, 0.1);
      border: 2px solid #8b5cf6;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .progress-bar-track {
      width: 100%;
      height: 12px;
      background: #2d3748;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid #4b5563;
      display: flex;
      gap: 2px;
      padding: 2px;
      box-sizing: border-box;
    }

    .progress-segment {
      flex: 1;
      min-width: 8px;
      height: 100%;
      background: #4b5563;
      border-radius: 3px;
      transition: all 0.4s ease;
    }

    .progress-segment.filled {
      background: linear-gradient(90deg, #8b5cf6, #06b6d4);
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.6);
    }

    .achievement-icons-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 8px;
      margin-bottom: 1rem;
    }

    .members-container {
      max-height: 150px;
      overflow-y: auto;
      padding: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .file-item {
      background: linear-gradient(135deg, rgba(30, 144, 255, 0.1), rgba(0, 206, 209, 0.1));
      border: 1px solid rgba(30, 144, 255, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      flex-wrap: wrap;
      gap: 12px;
    }

    .file-item:hover {
      background: linear-gradient(135deg, rgba(30, 144, 255, 0.2), rgba(0, 206, 209, 0.2));
      border-color: rgba(30, 144, 255, 0.6);
      transform: translateX(-5px);
    }

    .file-name {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 200px;
    }

    .file-name-text {
      word-break: break-word;
      color: #e0f2fe;
      font-weight: 500;
    }

    .file-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .file-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      white-space: nowrap;
      font-size: 0.85rem;
    }

    .file-btn-view {
      background: linear-gradient(135deg, #06b6d4, #0891b2);
      color: white;
    }

    .file-btn-view:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(6, 182, 212, 0.5);
    }

    .file-btn-delete {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }

    .file-btn-delete:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
    }

    .mission-vision-goal-card {
      background: linear-gradient(145deg, rgba(139, 92, 246, 0.15), rgba(6, 182, 212, 0.15));
      border: 2px solid rgba(139, 92, 246, 0.3);
      border-radius: 16px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .mvg-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .mvg-text {
      color: #e0f2fe;
      line-height: 1.6;
      margin-bottom: 12px;
      min-height: 60px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-size: 0.95rem;
    }
  </style>
</head>

<body class="h-full">
  <div class="app-wrapper">
    <div class="stars-bg" id="stars"></div>

    <div class="content-wrapper p-4 md:p-6 max-w-7xl mx-auto">
      <header class="text-center mb-8 slide-in">
        <div class="animate-float inline-block mb-6">
          <div class="w-32 h-32 rounded-full bg-gradient-to-br from-purple-500 to-cyan-500 flex items-center justify-center text-6xl">
            ğŸ•Œ
          </div>
        </div>

        <h1 class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-cyan-400 to-pink-400 mb-3">
          Ù…Ù„Ù Ø¥Ù†Ø¬Ø§Ø² Ù…Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ­ÙŠØ¯
        </h1>

        <div class="glass-card inline-block px-6 py-3 rounded-xl mb-6">
          <p class="text-slate-200 text-sm md:text-base">
            <span class="text-purple-400">Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø£Ø±Ø¨Ø¹ÙˆÙ†</span> |
            <span class="text-cyan-400">Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø³Ø§Ø¯Ø³Ø© ÙˆØ§Ù„Ø«Ù„Ø§Ø«ÙˆÙ†</span>
          </p>
          <p class="text-slate-300 text-xs md:text-sm mt-2">
            <span class="text-purple-400">Ø§Ù„Ù…Ø¹Ù„Ù…Ø©:</span> Ø£. Ø³Ø¹Ø§Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ |
            <span class="text-cyan-400">Ø§Ù„Ù…Ø¯ÙŠØ±Ø©:</span> Ø£. Ø¢Ù…Ø§Ù„ Ø¨Ø§Ø±Ø¨ÙˆØ¯
          </p>
        </div>

        <div class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="mission-vision-goal-card">
            <div class="mvg-title">ğŸ“š Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø§Ø¯Ø©</div>
            <div class="mvg-text">ØªÙƒÙˆÙŠÙ† Ø¹Ù‚Ù„ Ù…Ø³Ù„Ù… Ù‚ÙˆÙŠÙ… ÙŠØ¤Ù…Ù† Ø¨Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰</div>
          </div>

          <div class="mission-vision-goal-card">
            <div class="mvg-title">ğŸ”­ Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø§Ø¯Ø©</div>
            <div class="mvg-text">Ø·Ø§Ù„Ø¨Ø§Øª Ù…ØªÙ…Ø³ÙƒØ§Øª Ø¨Ø¹Ù‚ÙŠØ¯Ø© Ø§Ù„ØªÙˆØ­ÙŠØ¯</div>
          </div>

          <div class="mission-vision-goal-card">
            <div class="mvg-title">ğŸ¯ Ù‡Ø¯Ù Ø§Ù„Ù…Ù„Ù</div>
            <div class="mvg-text">ØªÙˆØ«ÙŠÙ‚ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø©</div>
          </div>
        </div>
      </header>

      <div class="semester-tabs">
        <button class="semester-tab-btn active" onclick="switchSemester('2-1')">ğŸ“š Ø«Ø§Ù†ÙŠ Ø£ÙˆÙ„</button>
        <button class="semester-tab-btn inactive" onclick="switchSemester('2-2')">ğŸ“– Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙŠ</button>
        <button class="semester-tab-btn inactive" onclick="switchSemester('2-3')">âœ¨ Ø«Ø§Ù†ÙŠ Ø«Ø§Ù„Ø«</button>
        <button class="semester-tab-btn inactive" onclick="switchSemester('2-4')">ğŸ¯ Ø«Ø§Ù†ÙŠ Ø±Ø§Ø¨Ø¹</button>
      </div>

      <div id="winner-section" style="display: none; margin-bottom: 2rem;">
        <div class="winner-badge">
          ğŸ‘‘ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ§ÙŠØ²Ø©: <span id="winner-name"></span> ğŸ†
        </div>
      </div>

      <div id="groups-container"></div>

      <footer class="text-center text-slate-400 text-sm py-6 border-t border-slate-700/50 mt-8">
        <p class="mb-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2026 | Ù…Ù„Ù Ø¥Ù†Ø¬Ø§Ø² Ù…Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ­ÙŠØ¯</p>
        <p class="text-pink-400 font-bold">ğŸ’– ØµÙ†Ø¹ Ø¨Ø­Ø¨ ÙˆØ¥Ø®Ù„Ø§Øµ â¤ï¸</p>
      </footer>
    </div>
  </div>

  <!-- File Preview Modal -->
  <div class="modal-overlay" id="filePreviewModal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeFileModal()">Ã—</button>
      <div id="filePreviewContent"></div>
    </div>
  </div>

  <!-- Comments Modal -->
  <div class="modal-overlay" id="commentModal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeCommentModal()">Ã—</button>
      <h2 class="text-xl font-bold text-purple-400 mb-4">ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</h2>
      <div id="commentsList"></div>

      <div class="mt-6 pt-4 border-t border-slate-700">
        <textarea id="newComment"
          class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-400 mb-3"
          rows="4" placeholder="Ø£Ø¶ÙŠÙÙŠ ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯..."></textarea>

        <button onclick="addComment()"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">
          âœ… Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚
        </button>
      </div>
    </div>
  </div>

  <script>
    const groupsNames = ['Ø§Ù„Ø·Ù…ÙˆØ­Ø§Øª', 'Ø§Ù„Ù…ÙˆØ§Ù‡Ø¨Ø§Øª', 'Ø§Ù„Ù…Ø¨Ø¯Ø¹Ø§Øª', 'Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø§Øª'];
    const groupsEmojis = ['ğŸ¯', 'â­', 'ğŸ’', 'ğŸŒŸ'];
    const groupsColors = ['from-purple-500 to-indigo-600', 'from-cyan-500 to-blue-600', 'from-pink-500 to-rose-600', 'from-amber-500 to-orange-600'];
    const achievementsList = [
      { emoji: 'ğŸ…', label: 'Ø¥Ù†Ø¬Ø§Ø² Ù…Ù…ØªØ§Ø²' },
      { emoji: 'ğŸ–ï¸', label: 'Ø¬Ù‡Ø¯ Ù…ØªÙ…ÙŠØ²' },
      { emoji: 'â­', label: 'Ù†Ø¬Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©' },
      { emoji: 'ğŸ‘¸', label: 'Ù…ØªÙÙˆÙ‚Ø©' }
    ];

    const semesterLabels = { '2-1': 'Ø«Ø§Ù†ÙŠ Ø£ÙˆÙ„', '2-2': 'Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙŠ', '2-3': 'Ø«Ø§Ù†ÙŠ Ø«Ø§Ù„Ø«', '2-4': 'Ø«Ø§Ù†ÙŠ Ø±Ø§Ø¨Ø¹' };
    const totalLessons = 20;

    let currentSemester = '2-1';
    let selectedGroupForComment = null;

    // =========================
    //  Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª + Ø§Ù„ØªØ®Ø²ÙŠÙ†
    // =========================
    let semestersData = {};
    Object.keys(semesterLabels).forEach(sem => {
      semestersData[sem] = {
        groups: [
          { members: [], files: { worksheets: [], summaries: [], projects: [] }, points: 0, comments: [], achievements: [false, false, false, false] },
          { members: [], files: { worksheets: [], summaries: [], projects: [] }, points: 0, comments: [], achievements: [false, false, false, false] },
          { members: [], files: { worksheets: [], summaries: [], projects: [] }, points: 0, comments: [], achievements: [false, false, false, false] },
          { members: [], files: { worksheets: [], summaries: [], projects: [] }, points: 0, comments: [], achievements: [false, false, false, false] }
        ]
      };
    });

    function loadFromStorage() {
      const stored = localStorage.getItem('towheedFilesData');
      if (stored) {
        try {
          semestersData = JSON.parse(stored);
        } catch (e) {
          console.log('Storage error');
        }
      }
    }

    function saveToStorage() {
      localStorage.setItem('towheedFilesData', JSON.stringify(semestersData));
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification-toast ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    function updateTabs() {
      document.querySelectorAll('.semester-tab-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.add('inactive');
      });
      const activeBtn = Array.from(document.querySelectorAll('.semester-tab-btn')).find(btn =>
        btn.textContent.includes(semesterLabels[currentSemester])
      );
      if (activeBtn) {
        activeBtn.classList.add('active');
        activeBtn.classList.remove('inactive');
      }
    }

    function updateWinner() {
      if (!currentSemester) return;
      const groups = semestersData[currentSemester].groups;
      let maxPoints = 0;
      let winnerIndex = -1;
      groups.forEach((group, idx) => {
        if (group.points > maxPoints) {
          maxPoints = group.points;
          winnerIndex = idx;
        }
      });
      const winnerSection = document.getElementById('winner-section');
      if (winnerIndex !== -1 && maxPoints > 0) {
        document.getElementById('winner-name').textContent = groupsNames[winnerIndex];
        winnerSection.style.display = 'block';
      } else {
        winnerSection.style.display = 'none';
      }
    }

    function switchSemester(semester) {
      currentSemester = semester;
      updateTabs();
      renderGroupsUI();
      updateWinner();
    }

    function renderProgressBar(fileCount) {
      let segments = '';
      const filledCount = fileCount % totalLessons;
      for (let i = 0; i < totalLessons; i++) {
        segments += `<div class="progress-segment ${i < filledCount ? 'filled' : ''}"></div>`;
      }
      return segments;
    }

    // âœ… Ù†ÙØ³ Ø§Ù„Ø´ÙƒÙ„ â€” ÙÙ‚Ø· Ø£Ø¶ÙÙ†Ø§ groupIndex Ù„Ù„Ø¹Ø±Ø¶/Ø§Ù„Ø­Ø°Ù Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
    function renderFilesList(files, category, groupIndex) {
      return files.map((file, index) => `
        <div class="file-item">
          <div class="file-name">
            <span style="font-size: 1.5rem;">${category === 'worksheets' ? 'ğŸ“' : category === 'summaries' ? 'ğŸ“‹' : 'ğŸ¬'}</span>
            <span class="file-name-text">${file.name}</span>
          </div>
          <div class="file-actions">
            <button class="file-btn file-btn-view" onclick="viewFile('${category}', ${groupIndex}, ${index})">ğŸ‘ï¸ Ø¹Ø±Ø¶</button>
            <button class="file-btn file-btn-delete" onclick="deleteFile('${category}', ${groupIndex}, ${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          </div>
        </div>
      `).join('');
    }

    function renderGroupsUI() {
      if (!currentSemester) return;
      const groups = semestersData[currentSemester].groups;
      const container = document.getElementById('groups-container');
      container.innerHTML = '';

      groups.forEach((group, index) => {
        const totalFiles = group.files.worksheets.length + group.files.summaries.length + group.files.projects.length;
        const cycleNumber = Math.floor(totalFiles / totalLessons) + 1;

        const groupCard = document.createElement('div');
        groupCard.className = 'section-card rounded-2xl p-6 mb-6 slide-in';
        groupCard.style.animationDelay = `${index * 0.1}s`;

        let groupHTML = `
          <div class="flex items-center gap-4 mb-6">
            <div class="w-16 h-16 rounded-xl bg-gradient-to-br ${groupsColors[index]} flex items-center justify-center text-3xl shadow-lg">
              ${groupsEmojis[index]}
            </div>
            <div>
              <h3 class="text-2xl font-bold text-white">${groupsNames[index]}</h3>
              <div class="flex gap-2 mt-1">
                <span class="text-yellow-400 font-bold">â­ ${group.points} Ù†Ù‚Ø·Ø©</span>
                <span class="text-cyan-400 font-bold">ğŸ”„ Ø¯ÙˆØ±Ø© ${cycleNumber}</span>
              </div>
            </div>
          </div>

          <div class="progress-container">
            <div class="progress-bar-track">${renderProgressBar(totalFiles)}</div>
            <div class="text-xs text-slate-400 mt-2">Ø§Ù„Ù…Ù„ÙØ§Øª: ${totalFiles}</div>
          </div>

          <div style="margin-bottom: 1rem; margin-top: 1rem;">
            <p class="text-sm font-bold text-purple-400 mb-2">ğŸ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª:</p>
            <div class="achievement-icons-group">
              ${achievementsList.map((ach, i) => {
                const isUnlocked = group.achievements[i];
                return `
                  <div class="achievement-icon ${isUnlocked ? 'unlocked' : 'locked'}"
                       onclick="toggleAchievement(${index}, ${i})"
                       title="${ach.label}">
                    ${ach.emoji}
                  </div>
                `;
              }).join('')}
            </div>
          </div>

          <div class="mb-4 p-3 bg-slate-800/40 rounded-lg border border-slate-700/50">
            <h4 class="text-cyan-400 font-bold mb-3">ğŸ‘¥ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª</h4>
            <div class="flex gap-2 mb-3">
              <input type="text" id="member-input-${index}" class="flex-1 bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø©..." onkeypress="if(event.key==='Enter') addMember(${index})">
              <button onclick="addMember(${index})" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded transition font-bold">+ Ø¥Ø¶Ø§ÙØ©</button>
            </div>
            <div id="members-${index}" class="flex flex-wrap gap-2 members-container"></div>
          </div>

          <div class="mb-4 p-3 bg-slate-800/40 rounded-lg">
            <h4 class="text-blue-400 font-bold mb-2">ğŸ“ Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„</h4>
            <input type="file" id="file-worksheets-${index}" class="block w-full text-sm text-slate-400 mb-2" multiple onchange="handleFileUpload(${index}, 'worksheets')">
            <div id="list-worksheets-${index}">${renderFilesList(group.files.worksheets, 'worksheets', index)}</div>
          </div>

          <div class="mb-4 p-3 bg-slate-800/40 rounded-lg">
            <h4 class="text-purple-400 font-bold mb-2">ğŸ“‹ Ø§Ù„ØªÙ„Ø®ÙŠØµØ§Øª</h4>
            <input type="file" id="file-summaries-${index}" class="block w-full text-sm text-slate-400 mb-2" multiple onchange="handleFileUpload(${index}, 'summaries')">
            <div id="list-summaries-${index}">${renderFilesList(group.files.summaries, 'summaries', index)}</div>
          </div>

          <div class="mb-4 p-3 bg-slate-800/40 rounded-lg">
            <h4 class="text-pink-400 font-bold mb-2">ğŸ¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h4>
            <input type="file" id="file-projects-${index}" class="block w-full text-sm text-slate-400 mb-2" multiple onchange="handleFileUpload(${index}, 'projects')">
            <div id="list-projects-${index}">${renderFilesList(group.files.projects, 'projects', index)}</div>
          </div>

          <button onclick="openCommentModal(${index})" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded transition font-bold">ğŸ’¬ ØªØ¹Ù„ÙŠÙ‚Ø§Øª (${group.comments.length})</button>
        `;

        groupCard.innerHTML = groupHTML;
        container.appendChild(groupCard);

        const membersList = document.getElementById(`members-${index}`);
        membersList.innerHTML = group.members.map(m => `
          <div class="member-badge">
            <div class="font-bold">${m.name}</div>
            <button onclick="deleteMember(${index}, '${m.name.replace(/'/g, "\\'")}')">Ã—</button>
          </div>
        `).join('');
      });
    }

    function addMember(groupIndex) {
      const input = document.getElementById(`member-input-${groupIndex}`);
      const name = input.value.trim();
      if (name) {
        const group = semestersData[currentSemester].groups[groupIndex];
        if (!group.members.some(m => m.name === name)) {
          group.members.push({ name });
          saveToStorage();
          input.value = '';
          renderGroupsUI();
          showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else {
          showNotification('Ø§Ù„Ø·Ø§Ù„Ø¨Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
        }
      }
    }

    function deleteMember(groupIndex, memberName) {
      const group = semestersData[currentSemester].groups[groupIndex];
      const memberIndex = group.members.findIndex(m => m.name === memberName);
      if (memberIndex !== -1) {
        group.members.splice(memberIndex, 1);
        saveToStorage();
        renderGroupsUI();
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨Ø©', 'success');
      }
    }

    // âœ… Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…: Ù†Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ù†ÙØ³Ù‡ (base64) ÙˆÙ„ÙŠØ³ Ø§Ù„Ø§Ø³Ù… ÙÙ‚Ø·
    // Ø¹Ø´Ø§Ù† "Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø§ ÙŠÙ†Ø­Ø°Ù" ÙˆÙŠØ¸Ù„ ÙŠÙØªØ­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø­ØªÙ‰ Ù„Ùˆ Ø§Ø®ØªÙÙ‰ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª
    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = () => reject(new Error('File read error'));
        reader.readAsDataURL(file);
      });
    }

    async function handleFileUpload(groupIndex, category) {
      const input = document.getElementById(`file-${category}-${groupIndex}`);
      const group = semestersData[currentSemester].groups[groupIndex];

      const filesArr = Array.from(input.files);
      if (!filesArr.length) return;

      for (const file of filesArr) {
        try {
          // ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
          if (file.size > 6 * 1024 * 1024) {
            showNotification('Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± ÙˆÙ‚Ø¯ Ù„Ø§ ÙŠÙØ­ÙØ¸ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­ âš ï¸', 'error');
          }

          const dataUrl = await readFileAsDataURL(file);
          const fileObj = {
            name: file.name,
            type: file.type || 'application/octet-stream',
            size: file.size,
            dataUrl: dataUrl,
            uploadedAt: new Date().toISOString()
          };
          group.files[category].push(fileObj);
          group.points += 1;
        } catch (e) {
          showNotification('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù', 'error');
        }
      }

      saveToStorage();
      input.value = '';
      renderGroupsUI();
      updateWinner();
      showNotification('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ­ÙØ¸Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­ âœ¨', 'success');
    }

    function viewFile(category, groupIndex, fileIndex) {
      const modal = document.getElementById('filePreviewModal');
      const content = document.getElementById('filePreviewContent');

      const group = semestersData[currentSemester].groups[groupIndex];
      const file = group.files[category][fileIndex];
      if (!file) {
        showNotification('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
      }

      const fileName = file.name;
      const type = file.type || '';
      const dataUrl = file.dataUrl;

      let previewHTML = '';

      if (dataUrl && type.startsWith('image/')) {
        previewHTML = `<img src="${dataUrl}" alt="${fileName}" style="max-width:100%; border-radius:12px;">`;
      } else if (dataUrl && type === 'application/pdf') {
        previewHTML = `<iframe src="${dataUrl}" style="width:100%; height:60vh; border:0; border-radius:12px; background:#0a0e27;"></iframe>`;
      } else if (dataUrl && type.startsWith('video/')) {
        previewHTML = `<video src="${dataUrl}" controls style="width:100%; max-height:60vh; border-radius:12px;"></video>`;
      } else if (dataUrl && type.startsWith('audio/')) {
        previewHTML = `<audio src="${dataUrl}" controls style="width:100%;"></audio>`;
      } else if (dataUrl) {
        // Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©: Ù†Ø®Ù„ÙŠÙ‡ ØªØ­Ù…ÙŠÙ„
        previewHTML = `
          <div class="glass-card p-4 rounded-xl">
            <p class="text-slate-200 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ†Ø²ÙŠÙ„Ù‡:</p>
            <a href="${dataUrl}" download="${fileName}" class="file-btn file-btn-view inline-block">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</a>
          </div>
        `;
      } else {
        previewHTML = `
          <div class="glass-card p-4 rounded-xl">
            <p class="text-slate-200">Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù‚Ø¯ÙŠÙ… ÙˆÙ„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ù…Ø­ØªÙˆØ§Ù‡ (ÙƒØ§Ù† ÙŠÙØ­ÙØ¸ Ø§Ù„Ø§Ø³Ù… ÙÙ‚Ø·).</p>
            <p class="text-slate-400 text-sm mt-2">Ø§Ø±ÙØ¹ÙÙ‡ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© Ù„ÙŠÙØ­ÙØ¸ ÙˆÙŠÙØªØ­ Ø¯Ø§Ø¦Ù…Ù‹Ø§.</p>
          </div>
        `;
      }

      content.innerHTML = `
        <h2 class="text-xl font-bold text-cyan-400 mb-4">ğŸ“„ ${fileName}</h2>
        <div style="background:#1a1f3a; padding: 16px; border-radius: 12px; margin-bottom: 1rem;">
          ${previewHTML}
        </div>
        <p class="text-slate-400 text-sm">âœ… Ù…Ø­ÙÙˆØ¸ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (LocalStorage) Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²/Ø§Ù„Ù…ØªØµÙØ­.</p>
      `;

      modal.classList.add('active');
      showNotification('ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ù„Ù ğŸ‘ï¸', 'success');
    }

    function closeFileModal() {
      document.getElementById('filePreviewModal').classList.remove('active');
    }

    function deleteFile(category, groupIndex, fileIndex) {
      const group = semestersData[currentSemester].groups[groupIndex];
      if (!group || !group.files[category] || !group.files[category][fileIndex]) return;

      group.files[category].splice(fileIndex, 1);
      group.points = Math.max(0, group.points - 1);

      saveToStorage();
      renderGroupsUI();
      updateWinner();
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©', 'success');
    }

    function openCommentModal(groupIndex) {
      selectedGroupForComment = groupIndex;
      const group = semestersData[currentSemester].groups[groupIndex];
      const commentsList = document.getElementById('commentsList');

      commentsList.innerHTML = group.comments.map((comment, i) => `
        <div class="comment-section mb-3 pb-3 border-b border-slate-700">
          <p class="text-slate-200 mb-2">${comment}</p>
          <button onclick="deleteComment(${groupIndex}, ${i})" class="text-red-400 text-sm hover:text-red-300">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
      `).join('');

      document.getElementById('commentModal').classList.add('active');
    }

    function closeCommentModal() {
      document.getElementById('commentModal').classList.remove('active');
      selectedGroupForComment = null;
      document.getElementById('newComment').value = '';
    }

    function addComment() {
      const commentText = document.getElementById('newComment').value.trim();
      if (!commentText || selectedGroupForComment === null) {
        showNotification('Ø£Ø¶ÙŠÙÙŠ ØªØ¹Ù„ÙŠÙ‚ ØµØ­ÙŠØ­', 'error');
        return;
      }

      const group = semestersData[currentSemester].groups[selectedGroupForComment];
      group.comments.push(commentText);
      saveToStorage();
      document.getElementById('newComment').value = '';
      openCommentModal(selectedGroupForComment);
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    function deleteComment(groupIndex, commentIndex) {
      const group = semestersData[currentSemester].groups[groupIndex];
      group.comments.splice(commentIndex, 1);
      saveToStorage();
      openCommentModal(groupIndex);
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'success');
    }

    function toggleAchievement(groupIndex, achIndex) {
      const group = semestersData[currentSemester].groups[groupIndex];
      group.achievements[achIndex] = !group.achievements[achIndex];
      saveToStorage();
      renderGroupsUI();
      showNotification(group.achievements[achIndex] ? 'ØªÙ… ÙØªØ­ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ğŸ‰' : 'ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', 'success');
    }

    function createStars() {
      const container = document.getElementById('stars');
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.width = (Math.random() * 2 + 1) + 'px';
        star.style.height = star.style.width;
        star.style.animationDelay = Math.random() * 3 + 's';
        container.appendChild(star);
      }
    }

    window.addEventListener('DOMContentLoaded', function() {
      createStars();
      loadFromStorage();
      renderGroupsUI();
      updateWinner();
    });

    document.getElementById('filePreviewModal').addEventListener('click', function(e) {
      if (e.target === this) closeFileModal();
    });

    document.getElementById('commentModal').addEventListener('click', function(e) {
      if (e.target === this) closeCommentModal();
    });
  </script>
</body>
</html>
  
